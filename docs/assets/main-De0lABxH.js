import"./style-Dh_Ea72S.js";import{b as y,c as L}from"./booksDatabase-OvQdqMMQ.js";const A=new Date,T=A.getFullYear();let l=[],s=[],f=[],h=[],b=[];const o=document.getElementById("filter-buttons"),i=document.getElementById("page-title"),D=document.querySelector("main");function N(){if(o){o.innerHTML="";const e=document.createElement("button"),t=document.createTextNode("Filter by Year");e.appendChild(t),e.setAttribute("type","button"),e.addEventListener("click",()=>{o.innerHTML="",f.forEach(d=>{let a=document.createElement("button");a.setAttribute("type","button");let u=document.createTextNode(`${d}`);a.appendChild(u),a.addEventListener("click",()=>g(d)),o.appendChild(a)})});const n=document.createElement("button"),r=document.createTextNode("Filter by Author");n.appendChild(r),n.setAttribute("type","button"),n.addEventListener("click",()=>{o.innerHTML="",h.forEach(d=>{let a=document.createElement("button");a.setAttribute("type","button");let u=document.createTextNode(d);a.appendChild(u),a.addEventListener("click",()=>B(d)),o.appendChild(a)})});const c=document.createElement("button"),m=document.createTextNode("Filter by Tag");c.appendChild(m),c.setAttribute("type","button"),c.addEventListener("click",()=>{o.innerHTML="",b.forEach(d=>{let a=document.createElement("button");a.setAttribute("type","button");let u=document.createTextNode(d);a.appendChild(u),a.addEventListener("click",()=>x(d)),o.appendChild(a)})}),o.appendChild(n),o.appendChild(c),o.appendChild(e)}}function C(){const e=document.createElement("button"),t=document.createElement("span");t.setAttribute("class","material-symbols-outlined");const n=document.createTextNode("filter_list");t.appendChild(n),e.appendChild(t);let r=document.createTextNode(" Filters");e.appendChild(r),e.setAttribute("id","more-filters"),e.setAttribute("type","button"),e.addEventListener("click",()=>{N()}),o&&o.appendChild(e)}function E(){const e=document.createElement("button");e.setAttribute("type","button");const t=document.createTextNode("Display All Books");e.appendChild(t),e.addEventListener("click",()=>{s=l,k(),p()}),o&&o.appendChild(e)}function k(){if(o){o.innerHTML="";const e=document.createElement("button");e.setAttribute("type","button");const t=document.createTextNode(`Filter for ${T} books`);e.addEventListener("click",()=>{g(T)}),e.appendChild(t),o.appendChild(e)}if(C(),i){i.innerHTML="";const e=document.createTextNode(`Displaying ${l.length} books`);i.appendChild(e)}}function g(e){o&&(o.innerHTML="",E(),C());const t=new Date(e,0,1).getFullYear();if(s=l.filter(n=>new Date(n.dateRead).getFullYear()===t),p(),i){const n=document.createTextNode(`Displaying ${s.length} books read in ${t}`);i.innerHTML="",i.appendChild(n)}}function B(e){if(o&&(o.innerHTML="",E(),C()),s=l.filter(t=>t.authors.includes(e)),p(),i){const t=document.createTextNode(`Displaying ${s.length} books by ${e}`);i.innerHTML="",i.appendChild(t)}}function x(e){if(o&&(o.innerHTML="",E(),C()),s=l.filter(t=>t.tags.includes(e)),p(),i){const t=document.createTextNode(`Displaying ${s.length} books matching ${e}`);i.innerHTML="",i.appendChild(t)}}function v(e){e.forEach(t=>{t.authors.forEach(n=>{h.includes(n)||h.push(n)})}),h.sort((t,n)=>{const r=t.split(" ").pop()??"",c=n.split(" ").pop()??"";return r.localeCompare(c)})}function F(e){e.forEach(t=>{t.tags.forEach(n=>{b.includes(n)||b.push(n)})}),b.sort()}function w(e){e.forEach(t=>{let n=new Date(t.dateRead).getFullYear();f.includes(n)||f.push(n)}),f.sort()}function p(){let e=document.getElementById("books-contianer");if(e&&e.remove(),s.length===0){let t=document.createElement("div"),n=document.createElement("p");n.textContent="No books found",t.appendChild(n)}else e=s.reduce((t,n)=>{const r=document.createElement("article");r.setAttribute("class","card hide-overflow");const c=L(n);return r.appendChild(c),t.appendChild(r),t},document.createElement("div")),e.setAttribute("id","books-contianer"),D.appendChild(e)}function M(){y.resetDatabase(),window.location.reload()}async function H(){const e=await y.getVersions(),t=document.querySelector("footer"),n=document.createElement("p"),r=document.createElement("strong");r.textContent="Schema: ",n.appendChild(r);const c=document.createElement("span");c.textContent=`${e.dbVersion}`,n.appendChild(c);const m=document.createElement("strong");m.textContent=" | Data: ",n.appendChild(m);const d=document.createElement("span");d.textContent=`${e.storedDataVersion}`,n.appendChild(d);const a=document.createElement("strong");a.textContent=" | Last Sync: ",n.appendChild(a);const u=document.createElement("span");u.textContent=`${e.lastUpdated}`,n.appendChild(u),n.addEventListener("click",()=>M()),t.appendChild(n)}async function S(){try{await y.initializeData(),l=await y.getAllBooks(),s=l,F(l),v(l),w(l),k();const e=new URLSearchParams(window.location.search),t=e.get("year"),n=e.get("author"),r=e.get("tag");t?g(parseInt(t)):n?B(n):r?x(r):p(),await H(),console.log("Application loaded with books:",l)}catch(e){console.error("Critical error during application startup:",e)}}S();
